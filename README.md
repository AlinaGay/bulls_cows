# Быки и Коровы: AI vs AI

Реализация классической игры "Быки и Коровы", где два AI-агента на базе YandexGPT играют друг против друга.

## Описание

Программа проводит турнир из двух раундов между AI-агентами:
- **Раунд 1:** Player_1 загадывает число, Player_2 отгадывает
- **Раунд 2:** Player_2 загадывает число, Player_1 отгадывает

Каждый агент использует свою стратегию отгадывания. Побеждает тот, кто угадал число за меньшее количество ходов.

## Правила игры

- Загадывается 4-значное число с неповторяющимися цифрами (1023-9876)
- Первая цифра не может быть 0
- **Бык** — цифра угадана и стоит на правильной позиции
- **Корова** — цифра есть в числе, но на другой позиции
- **Победа** — 4 быка (число угадано полностью)
- Максимум 10 попыток на раунд

## Установка

### 1. Клонирование репозитория
```bash
git clone https://github.com/username/bulls_cows.git
cd bulls_cows
```

### 2. Создание виртуального окружения
```bash
python -m venv .venv
source .venv/bin/activate  # Linux/Mac
# или
.venv\Scripts\activate     # Windows
```

### 3. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 4. Настройка переменных окружения

Создайте файл `.env` в корне проекта:
```env
YANDEX_FOLDER_ID=ваш_folder_id
YANDEX_API_KEY=ваш_api_key
API_BASE_URL=https://llm.api.cloud.yandex.net/v1
MODEL=yandexgpt-lite/rc
```

## Запуск
```bash
python main.py
```

## Структура проекта
```
bulls_cows/
├── main.py              # Точка входа
├── game.py              # Логика игры и раунда
├── player.py            # Класс игрока (взаимодействие с API)
├── prompts.py           # Системные промпты и стратегии
├── utils.py             # Вспомогательные функции
├── config.py            # Конфигурация
├── client.py            # OpenAI клиент для Yandex API
├── logging_config.py    # Настройка логирования
├── requirements.txt     # Зависимости
├── .env                 # Переменные окружения (не в git)
├── logs/                # Логи игр
└── README.md
```

## Стратегии агентов

### Player_1: Быстрое сканирование

1. **Фаза сканирования:** первые ходы — 1234, затем 5678
2. **Фаза определения:** по сумме быков и коров определяет "активные" цифры
3. **Фаза перестановок:** переставляет найденные цифры до победы

### Player_2: Логическая дедукция

1. **Анализ результатов:** исключает невозможные цифры
2. **Логика позиционирования:** фиксирует быков, перемещает коров
3. **Комбинирование:** использует информацию из ВСЕХ предыдущих попыток

## Архитектура

### Разделение ответственности

| Компонент | Ответственность |
|-----------|-----------------|
| `Game` | Управление раундом, валидация, подсчёт результата |
| `Player` | Взаимодействие с API, генерация ходов |
| `utils` | Валидация чисел, расчёт быков/коров, парсинг JSON |
| `prompts` | Системные промпты и стратегии |

### Валидация и надёжность

- **Двойная проверка:** агент считает быков/коров, движок проверяет
- **Fallback:** при невалидном числе генерируется случайное
- **Парсинг:** обрабатывает markdown-блоки и некорректный JSON

## Логирование

Логи сохраняются в папку `logs/` с именем `game_YYYY-MM-DD_HH-mm-ss.txt`.

### Пример лога
```
2026-02-10 12:30:45 | ==================================================
2026-02-10 12:30:45 | БЫКИ И КОРОВЫ: AI vs AI
2026-02-10 12:30:45 | ==================================================
2026-02-10 12:30:45 | 
2026-02-10 12:30:45 | РАУНД 1: Player_1 загадывает, Player_2 угадывает
2026-02-10 12:30:46 | Player_1 загадал число: 3814
2026-02-10 12:30:47 | Ход 1: 1234 → 1Б 2К
2026-02-10 12:30:48 | Ход 2: 4312 → 1Б 2К
2026-02-10 12:30:49 | Ход 3: 3142 → 1Б 2К
2026-02-10 12:30:50 | Ход 4: 3814 → 4Б 0К
2026-02-10 12:30:50 | Player_2 угадал за 4 ходов!
2026-02-10 12:30:50 | 
2026-02-10 12:30:50 | РАУНД 2: Player_2 загадывает, Player_1 угадывает
2026-02-10 12:30:51 | Player_2 загадал число: 5672
2026-02-10 12:30:52 | Ход 1: 1234 → 0Б 1К
2026-02-10 12:30:53 | Ход 2: 5678 → 2Б 1К
2026-02-10 12:30:54 | Ход 3: 5672 → 4Б 0К
2026-02-10 12:30:54 | Player_1 угадал за 3 ходов!
2026-02-10 12:30:54 | 
2026-02-10 12:30:54 | ========================================
2026-02-10 12:30:54 | ИТОГИ
2026-02-10 12:30:54 | ========================================
2026-02-10 12:30:54 | Раунд 1: 4 ходов
2026-02-10 12:30:54 | Раунд 2: 3 ходов
2026-02-10 12:30:54 | Победитель: Player_1
2026-02-10 12:30:54 | Игра завершена
```

## Технический стек

- **Python** 3.12+
- **OpenAI SDK** — взаимодействие с Yandex AI Studio API
- **Loguru** — логирование
- **python-dotenv** — переменные окружения

## Известные особенности

1. **Ошибки подсчёта агентом:** LLM иногда неправильно считает быков/коров — движок всегда проверяет и исправляет
2. **Повторяющиеся ходы:** агент может повторять попытки, несмотря на инструкции в промпте
3. **Температура 0.5:** баланс между креативностью и стабильностью

## Лицензия

MIT
